# Internationalization (i18n) Guide

This documentation uses Sphinx's i18n capabilities to support multiple languages.

## Current Status

- **English** (main language) - Complete
- **German** - To be translated

## How Sphinx i18n Works

1. English RST files are the source (in `docs/`)
2. `make gettext` extracts translatable strings to `.pot` files
3. `.pot` files are converted to `.po` files for each language
4. Translators fill in the `.po` files
5. Building with `-D language=de` uses German translations

## Creating German Translation

### Step 1: Extract Translatable Strings

```bash
cd docs
make gettext
```

This creates `.pot` (Portable Object Template) files in `_build/gettext/`.

### Step 2: Initialize German Locale

```bash
# Install sphinx-intl if not already installed
pip install sphinx-intl

# Initialize German locale
sphinx-intl update -p _build/gettext -l de
```

This creates `locale/de/LC_MESSAGES/*.po` files.

### Step 3: Translate

Edit the `.po` files in `locale/de/LC_MESSAGES/`:

```po
# locale/de/LC_MESSAGES/index.po
#: ../../index.rst:1
msgid "BThomeV2 - BLE Sensor Library & Testing Tool"
msgstr "BThomeV2 - BLE Sensor Bibliothek & Testing Tool"

#: ../../index.rst:20
msgid "Overview"
msgstr "Ãœberblick"
```

### Step 4: Build German Documentation

```bash
# Build German version
make html -D language=de

# Or set in conf.py temporarily:
# language = 'de'
```

### Step 5: View

```bash
firefox _build/html/index.html
```

## Translation Workflow

### Update Translations After Documentation Changes

```bash
# 1. Extract new strings
make gettext

# 2. Update .po files with new strings
sphinx-intl update -p _build/gettext -l de

# 3. Translate new/updated strings in .po files

# 4. Build
make html -D language=de
```

## ReadTheDocs Integration

To have ReadTheDocs build German documentation:

### Option 1: Language Selector (Recommended)

1. Go to ReadTheDocs project settings
2. Add "de" as a language
3. ReadTheDocs will build both en and de versions
4. Users can switch between languages in the UI

### Option 2: Separate Project

1. Create a second ReadTheDocs project (e.g., "bthomev2-de")
2. Point to same repository
3. In project settings, set:
   - Configuration file: `.readthedocs.yaml`
   - Environment variable: `READTHEDOCS_LANGUAGE=de`
4. Modify conf.py to use this variable

## Tools

### sphinx-intl

Install: `pip install sphinx-intl`

Useful commands:

```bash
# Update all .po files
sphinx-intl update -p _build/gettext -l de

# Update specific .po file
sphinx-intl update -p _build/gettext -l de --pot-dir _build/gettext/library/

# Statistics
sphinx-intl stat
```

### Poedit

GUI tool for editing .po files: <https://poedit.net/>

## Translation Guidelines

1. **Keep technical terms in English:**
   - API, BLE, RSSI, etc.
   - Code examples stay in English

2. **Translate user-facing content:**
   - Headings, descriptions, instructions
   - Error messages, warnings

3. **Maintain formatting:**
   - Keep RST formatting markers
   - Don't translate code blocks
   - Preserve links and references

4. **Code examples:**
   - Keep code unchanged
   - Translate comments in code

## Current Translation Priority

1. High priority:
   - index.rst
   - installation.rst
   - quickstart.rst

2. Medium priority:
   - library/api.rst
   - tools/bthome-logger.rst

3. Low priority:
   - development/ (developers can read English)

## Automation

Consider using translation services or AI for initial translation,
then manually review:

```bash
# Example: Use DeepL API or similar
for po in locale/de/LC_MESSAGES/*.po; do
  # Extract msgid, translate, fill msgstr
  # (requires custom script or tool)
done
```

## Testing

Before committing translations:

```bash
# Build and check for errors
make clean
make html -D language=de

# Check for warnings
make html -D language=de -W

# View result
firefox _build/html/index.html
```

## Contributing Translations

1. Fork repository
2. Create translation branch: `git checkout -b translation/german`
3. Follow steps above to create/update translations
4. Commit `.po` files: `git add locale/de/`
5. Create pull request

## References

- [Sphinx i18n documentation](https://www.sphinx-doc.org/en/master/usage/advanced/intl.html)
- [sphinx-intl](https://pypi.org/project/sphinx-intl/)
- [GNU gettext](https://www.gnu.org/software/gettext/)
